# ğŸ³ Base image nháº¹, á»•n Ä‘á»‹nh cho React
FROM node:20-alpine

# ğŸ“ Táº¡o thÆ° má»¥c lÃ m viá»‡c trong container
WORKDIR /app

# âš™ï¸ Copy file khai bÃ¡o dependency trÆ°á»›c Ä‘á»ƒ táº­n dá»¥ng cache
COPY package*.json ./

# ğŸ§° CÃ i Ä‘áº·t cÃ¡c gÃ³i cáº§n thiáº¿t cho build (Alpine tá»‘i giáº£n nÃªn pháº£i thÃªm)
RUN apk add --no-cache bash python3 make g++

# ğŸ“¦ CÃ i dependency
RUN npm install

# ğŸ“¦ Copy toÃ n bá»™ source code vÃ o container
COPY . .

# ğŸŒ Nháº­n biáº¿n mÃ´i trÆ°á»ng tá»« docker-compose (vÃ­ dá»¥ API URL)
ARG REACT_APP_API_URL
ENV REACT_APP_API_URL=${REACT_APP_API_URL}

# ğŸ§± Build app (CI=false Ä‘á»ƒ trÃ¡nh build fail do warning)
RUN echo "ğŸŒ Using API URL: $REACT_APP_API_URL" && CI=false npm run build

# ğŸ§° CÃ i `serve` Ä‘á»ƒ cháº¡y file build tÄ©nh
RUN npm install -g serve

# ğŸšª Má»Ÿ port 3000 Ä‘á»ƒ container láº¯ng nghe
EXPOSE 3000

# ğŸš€ Cháº¡y app á»Ÿ cháº¿ Ä‘á»™ production
CMD ["serve", "-s", "build", "-l", "3000"]
